---
name: 향후 기능 개발 계획 (순서대로)
overview: DramLog의 향후 추가될 기능들을 순서대로 개발하는 계획입니다. (현재: Anonymous Auth + RLS + 게시글/검색/댓글/좋아요 + UI/UX + Vercel 배포까지 완료)
todos: []
---

# 향후 기능 개발 계획 (순서대로)

## 목표
DramLog의 핵심 기능들을 순서대로 개발하여 완성도 높은 커뮤니티 플랫폼을 구축합니다.

## 개발 순서

### 1. ✅ Supabase Anonymous Auth + RLS 설정 (최우선) 🔥 - 완료
**목표**: 보안 강화 및 익명 사용자 지원

#### 1.1 ✅ Anonymous Auth 설정 - 완료
- ✅ `supabase-schema.sql`: RLS 정책 SQL 추가 완료
- ✅ `src/lib/server/supabase/auth.ts`: Anonymous Auth 헬퍼 함수 추가
  - `createAnonymousSession()`: 익명 세션 생성
  - `getUserOrCreateAnonymous()`: 세션이 없으면 익명 세션 생성
  - `getUser()`: 익명 사용자 정보 포함 (`isAnonymous` 필드 추가)
- ✅ 익명 사용자와 로그인 사용자 구분 로직 구현

#### 1.2 ✅ RLS (Row Level Security) 정책 설정 - 완료
- ✅ **posts 테이블**:
  - 읽기: 모든 사용자 (익명 포함) 읽기 가능
  - 작성: 모든 사용자 (익명 포함) 작성 가능
  - 수정: 로그인 글은 작성자만, 익명 글은 서버에서 비밀번호 검증
  - 삭제: 로그인 글은 작성자만, 익명 글은 서버에서 비밀번호 검증
- ✅ **comments 테이블**:
  - 읽기: 모든 사용자 읽기 가능
  - 작성: 로그인 사용자만 (`auth.role() = 'authenticated'`)
  - 수정/삭제: 작성자 본인만 (`auth.uid() = user_id`)
- ✅ **likes 테이블**:
  - 읽기: 모든 사용자 읽기 가능
  - 작성/삭제: 로그인 사용자만 (`auth.role() = 'authenticated'`)

#### 1.3 ✅ 구현 파일 - 완료
- ✅ `supabase-schema.sql`: RLS 정책 SQL 추가 완료
- ✅ `src/lib/server/supabase/auth.ts`: Anonymous Auth 헬퍼 함수 추가 완료
- ✅ `src/lib/server/supabase/client.ts`: 세션 토큰을 사용하는 클라이언트 생성 함수 추가
- ✅ `src/lib/server/supabase/queries/posts.ts`: `createPost` 함수에 세션 토큰 지원 추가
- ✅ `src/routes/write/+page.server.ts`: 익명 사용자도 세션 생성하도록 수정
- ✅ `SUPABASE_RLS_SETUP.md`: 설정 가이드 문서 생성

#### 1.4 ⚠️ Supabase 대시보드에서 해야 할 작업
- [x] Supabase 대시보드 → Authentication → Providers → Anonymous 활성화
- [x] Supabase 대시보드 → SQL Editor에서 `supabase-schema.sql`의 RLS 정책 실행

---

### 2. 이미지 업로드 기능 (Supabase Storage)
**목표**: 게시글에 이미지 첨부 기능 추가

#### 2.1 Supabase Storage 설정
- Storage 버킷 생성 (`post-images`)
- 버킷 정책 설정 (읽기: 공개, 쓰기: 인증된 사용자)
- 이미지 최적화 (WebP 변환, 썸네일 생성)

#### 2.2 데이터베이스 스키마
- `posts` 테이블에 `image_urls TEXT[]` 컬럼 추가 (여러 이미지 지원)
- 또는 별도 `post_images` 테이블 생성

#### 2.3 구현 파일
- `src/lib/server/supabase/storage.ts`: Storage 업로드/삭제 함수
- `src/lib/components/ImageUpload.svelte`: 이미지 업로드 컴포넌트
- `src/routes/write/+page.svelte`: 이미지 업로드 UI 통합
- `src/routes/posts/[id]/+page.svelte`: 이미지 표시

---

### 3. 사용자 프로필 페이지
**목표**: 사용자 프로필 및 작성 게시글 관리

#### 3.1 프로필 페이지
- 라우트: `/profile` (본인), `/profile/[userId]` (다른 사용자)
- 프로필 정보 표시 (닉네임, 이메일, 가입일)
- 작성한 게시글 목록
- 통계 (작성 게시글 수, 받은 좋아요 수 등)

#### 3.2 프로필 편집
- 닉네임 변경
- 프로필 소개 추가 (향후)
- 프로필 이미지 업로드 (향후)

#### 3.3 구현 파일
- `src/routes/profile/+page.svelte`: 프로필 페이지
- `src/routes/profile/[userId]/+page.svelte`: 다른 사용자 프로필
- `src/lib/server/supabase/queries/users.ts`: 사용자 쿼리 함수

---

### 4. 북마크 기능
**목표**: 게시글 북마크 저장 및 관리

#### 4.1 데이터베이스 스키마
- `bookmarks` 테이블 생성
  - `id UUID PRIMARY KEY`
  - `user_id UUID NOT NULL` (로그인 사용자만)
  - `post_id UUID NOT NULL REFERENCES posts(id)`
  - `created_at TIMESTAMPTZ DEFAULT NOW()`
  - `UNIQUE(user_id, post_id)`

#### 4.2 기능 구현
- 북마크 버튼 컴포넌트
- 북마크한 게시글 목록 페이지 (`/bookmarks`)
- 북마크 토글 기능

#### 4.3 구현 파일
- `supabase-schema.sql`: `bookmarks` 테이블 추가
- `src/lib/server/supabase/queries/bookmarks.ts`: 북마크 쿼리 함수
- `src/lib/components/BookmarkButton.svelte`: 북마크 버튼
- `src/routes/bookmarks/+page.svelte`: 북마크 목록 페이지

---

### 5. 태그 시스템
**목표**: 게시글 태그 추가 및 태그별 필터링

#### 5.1 데이터베이스 스키마
- `tags` 테이블 생성
  - `id UUID PRIMARY KEY`
  - `name TEXT NOT NULL UNIQUE`
  - `created_at TIMESTAMPTZ DEFAULT NOW()`
- `post_tags` 테이블 생성 (다대다 관계)
  - `post_id UUID REFERENCES posts(id)`
  - `tag_id UUID REFERENCES tags(id)`
  - `PRIMARY KEY (post_id, tag_id)`

#### 5.2 기능 구현
- 게시글 작성 시 태그 입력/선택
- 태그별 게시글 필터링 (`/tags/[tagName]`)
- 인기 태그 표시
- 태그 자동완성

#### 5.3 구현 파일
- `supabase-schema.sql`: `tags`, `post_tags` 테이블 추가
- `src/lib/server/supabase/queries/tags.ts`: 태그 쿼리 함수
- `src/lib/components/TagInput.svelte`: 태그 입력 컴포넌트
- `src/routes/tags/[name]/+page.svelte`: 태그별 게시글 목록

---

### 6. 위스키 정보 데이터베이스
**목표**: 위스키 정보 관리 및 게시글과 연결

#### 6.1 데이터베이스 스키마
- `whiskies` 테이블 생성
  - `id UUID PRIMARY KEY`
  - `name TEXT NOT NULL` (위스키 이름)
  - `brand TEXT` (브랜드)
  - `region TEXT` (지역: 스코틀랜드, 아일랜드 등)
  - `type TEXT` (타입: 싱글 몰트, 블렌디드 등)
  - `abv DECIMAL` (알코올 도수)
  - `description TEXT` (설명)
  - `image_url TEXT` (이미지)
  - `created_at TIMESTAMPTZ DEFAULT NOW()`
- `posts` 테이블에 `whiskey_id UUID REFERENCES whiskies(id)` 컬럼 추가

#### 6.2 기능 구현
- 위스키 검색/필터링
- 위스키별 게시글 모아보기
- 위스키 상세 페이지
- 위스키 정보 편집 (관리자 또는 커뮤니티)

#### 6.3 구현 파일
- `supabase-schema.sql`: `whiskies` 테이블 추가
- `src/lib/server/supabase/queries/whiskies.ts`: 위스키 쿼리 함수
- `src/routes/whiskies/+page.svelte`: 위스키 목록
- `src/routes/whiskies/[id]/+page.svelte`: 위스키 상세
- `src/lib/components/WhiskeySelector.svelte`: 위스키 선택 컴포넌트

---

## 우선순위 요약

1. 이미지 업로드 기능 (Supabase Storage)
2. 사용자 프로필 페이지
3. 북마크 기능
4. 태그 시스템
5. 위스키 정보 데이터베이스
6. (운영) 관리자/모더레이션 도구(신고/차단), 스팸 방지, 감사로그

## 다음 작업(추천 순서)

### A. 배포/운영 안정화(1~2일)
- Vercel Preview 도메인까지 쓸 경우 Supabase Redirect URLs에 `https://*.vercel.app/*` 포함 여부 재확인
- 에러/로그 관측(간단): Vercel Logs 확인 루틴 문서화
- (선택) 커스텀 도메인 연결 시 Supabase Site URL/Redirect URLs 재설정 절차 문서화

### B. 이미지 업로드(MVP 확장)
- Supabase Storage 버킷 `post-images` 생성 + 정책 설계(RLS/공개 범위)
- DB 스키마 확정: `posts.image_urls TEXT[]` vs `post_images` 테이블
- 작성/수정 페이지에 업로드 UI 추가 + 상세 페이지 렌더링

### C. 프로필/북마크/태그
- `profiles` 테이블(닉네임/아바타 등) 확장 여부 결정
- 북마크 테이블 + `/bookmarks` 라우트
- 태그 입력/검색/필터 라우트

## 참고사항

- 각 기능은 독립적으로 개발 가능하지만, 순서대로 진행하는 것을 권장
- RLS 설정은 모든 기능의 기반이 되므로 반드시 먼저 완료해야 함
- 각 기능 완료 후 테스트 및 문서 업데이트 필수
